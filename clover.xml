<?xml version="1.0"?>
<project name="clover">

  <taskdef resource="cloverlib.xml" classpath="${clover.jar}"/>

  <target name="with.clover">
    <clover-setup initstring="${build}/instrument/coverage.db">
      <files>
        <exclude name="**/OSGiServiceRegistry.java"/>
      </files>
      <methodContext name="toString" regexp="public String toString\(\).*"/>
      <methodContext name="privateCtor" regexp="private \w+\(\).*"/>
      <statementContext name="ldr1" regexp="^if \(resolve\) \{.*"/>
      <statementContext name="ldr2" regexp="^if \(null == typeLoader .*"/>
      <statementContext name="match" regexp="^if \(null == element\) \{.*"/>
      <testsources dir="${test}">
        <testclass package=".*test.*"/>
      </testsources>
    </clover-setup>
  </target>

  <target name="clover.report">
    <clover-report>
      <current outfile="${doc}/coverage" title="peaberry">
        <format type="html" filter="toString,privateCtor,ldr1,ldr2,match"/>
      </current>
    </clover-report>
  </target>

</project>
